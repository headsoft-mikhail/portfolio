# Решение [задания](https://github.com/netology-code/python-final-diplom/tree/master) к дипломной работе к профессии Python-разработчик «API Сервис заказа товаров для розничных сетей»

За основу был взят предложенный референсный [проект](https://github.com/netology-code/python-final-diplom/tree/master/reference) 

## Список запросов, доступных всем пользователям:
### Без входа в аккаунт:
1. создать пользователя
1. активировать пользователя
1. войти в аккаунт и получить токен
1. получить список товаров с фильтрацией по категории и магазину
1. получить список категорий
1. получить список магазинов, принимающих заказы
1. получить данные магазина


### После входа в аккаунт:
1. получить данные пользователя
1. изменить данные пользователя
1. сброс пароля
1. сброс пароля - подтверждение
1. создать контакт для пользователя
1. получить все контакты пользователя
1. изменить контакт пользователя
1. удалить контакт пользователя
1. выйти из аккаутна и удалить полученный ранее токен
  
Примеры запросов: [requests_examples_common.http](https://github.com/headsoft-mikhail/netology_graduation/blob/master/requests_examples_common.http)


## Список запросов, доступный только покупателям после входа в аккаунт:
  
1. добавить товар в корзину
1. изменить количество товара в корзине
1. получить товары в корзине
1. удалить товар из корзины (или все товары)
1. получить заказы пользователя
1. получить детали выбранного заказа
1. разместить заказ из корзины, указав свой контакт  

Примеры запросов покупателя: [requests_examples_for buyers.http](https://github.com/headsoft-mikhail/netology_graduation/blob/master/requests_examples_for_buyers.http)
   
## Список запросов, доступный только менеджерам магазинов после входа в аккаунт:

1. создать магазин
1. обновить данные магазина, в том числе статус приема заказов и url файла со списком товаров в заданном формате
1. получить данные своего магазина
1. получить заказы своего магазина
1. получить данные выбранного заказа

## Список запросов, доступный администратору площадки
1. получить данные любого заказа
1. изменить статус любого заказа 

Примеры запросов магазина + администратора: [requests_examples_for_shops.http](https://github.com/headsoft-mikhail/netology_graduation/blob/master/requests_examples_for_shops.http)

## Основной сценарий работы:

1. Менеджер создает аккаунт, указав `type='shop'`. Получает на указанную электронную почту письмо с 5-значным токеном подтверждения почтового адреса. Отправляет запрос подтверждения почты с указанием полученного токена.
1. Менеджер входит в созданный аккаунт, получая токен. Дальнейшие запросы выполняются с использованием этого токена.
1. Менеджер создает магазин. Связь 1 магазин - 1 аккаунт. Сразу при создании магазина, либо отправив запрос на редактирование данных магазина, менеджер указывает url файла со списком товаров и устанавливает статус приема заказов `'state'='true'`. После этого товары магазина будут появляться при запросах покупателей. 
1. Покупатель создает аккаунт, указав `type='buyer'`. Получает на указанную электронную почту письмо с 5-значным токеном подтверждения почтового адреса. Отправляет запрос подтверждения почты с указанием полученного токена. 
1. Покупатель запрашивает список товаров в наличии, выбирает нужный товар и добавляет его в корзину. Можно добавить несколько товаров от разных магазинов(поставщиков). 
1. Покупатель запрашивает товары в корзине, редактирует количество товара если нужно, или удаляет ненужные товары из корзины.
1. Покупатель создает контакт(адрес получения) и оформляет заказ с указанием контакта. После оформления заказа покупателю на почту отправляется письмо со списком товаров в заказе, такое же письмо получает(ют) администратор(ы) площадки. Также письма получают менеджеры магазинов, товары которых выбраны в заказе, каждый менеджер получает товары только из своего магазина.
1. Менеджер запрашивает список заказов своего магазина, выбирает (скорее всего - последний) заказ - получает его детали, начинает выполнение заказа.
1. Покупатель может просматривать историю своих заказов и детали каждого своего заказа.
1. Администратор площадки (через API) запрашивает информацию о заказе, изменяет статус заказа в процессе его выполнения. Покупатель, администратор(ы) площадки и менеджеры задействованных в заказе магазинов получают уведомления об изменении статуса заказа.

## Комментарии
1. Переменные, содержащие пароли, токены, почтовые адреса вынесены в файл [tokens.py](https://github.com/headsoft-mikhail/netology_graduation/blob/master/tokens.py)
1. У всех пользователей в качестве username используется email. username не задается. 
1. Аккаунт администратора площадки можно создать только через консоль, при этом нужно указывать корректный почтовый адрес:
``` 
    python manage.py creteasuperuser
```

4. Для проверки работоспособности сервиса в части ответов на запросы пользователей, помимо файлов с примерами запросов, были написаны тесты в файле [backend/tests.py](https://github.com/headsoft-mikhail/netology_graduation/blob/master/backend/tests.py). Для запуска нужно выполнить команду:  
``` 
    python manage.py test
```
5. Добавлен простой DRF тротлинг
6. Добавлено больше docstring к методам.  
7. Добавлена автогенерация документации в рамках пакета DRF-Spectacular 
    * Т.к. в проекте использованы APIViews, авторгенерация работает не полностью корректно, но суть понятна.  

    Для генерации файла ([schema.yml](https://github.com/headsoft-mikhail/netology_graduation/blob/master/backend/schema.yml)) с документацией выполнить команду:
```
python manage.py spectacular --file schema.yml
```
8. Отправка почтовых сообщений вынесена в celery-приложение ([netology_pd_diplom/celery.py](https://github.com/headsoft-mikhail/netology_graduation/blob/master/netology_pd_diplom/celery.py), [backend/tasks.py](https://github.com/headsoft-mikhail/netology_graduation/blob/master/backend/tasks.py)).  Для запуска redis - выполнить команду:
```
docker run -d -p 6379:6379 redis
```
Для запуска celery выполнить команду:
```
celery -A netology_pd_diplom worker -l info
```
